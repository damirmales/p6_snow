{% extends 'base.html.twig' %}

{% block title %}
    Modifier {{ fig.title }}
{% endblock %}

{% form_theme form _self %} {#  #}

{% block body %}
    <div class="container mt-4">
        <h1>Modifier {{ fig.title }}</h1>
        <div class="row mt-4">
            <div class="col featureImageFigure"
                 style="background-image:url( {{ asset('/uploads/figures/') }}{{ fig.featureImage }});background-size: cover;">
                <h1 class="display-3 text-center"> {{ fig.title }}</h1>
                <div class="card-header">
                    <a href="{{ path('image_presentation', {'slug': fig.slug}) }}"><i class='fas fa-pen'></i></a>
                    <a href="{{ path('delete_feature_image', {'slug': fig.slug}) }}"> <i
                                class='fas fa-trash-alt'></i></a>
                </div>
            </div>
        </div>
        <!-- Link add medias-->
        <div class="row">
            <div class="col">
                {% if app.user %}
                    <a href="{{ path('create_media', {'slug': fig.slug}) }}" class="">ajout médias</a>
                {% endif %}
            </div>
        </div>

        <!-- Afficher les photos si existantes -->
        {% if photos %}
            <div class="alert alert-danger">
                Photos là
            </div>

            <!-- Portfolio Gallery pictures -->
            <div class="row mt-4">
                <div class="col">
                    <h3> Images</h3>
                </div>
            </div>
            <div class="row">
                {% for photo in photos %}
                    {% if photo.filename %}
                        <div class="col-12 col-lg-3 col-md-3 grid-item text-center" style="display: block;">

                            <img src="{{ asset('/uploads/figures/') }}{{ photo.filename }}"
                                 alt="image de figure snowboard"
                                 style="width:150px">


                            <div class="card-header">
                                <a href="{{ path('edit_photo',{'slug':photo.figure.slug,'id':photo.id}) }}"><i
                                            class='fas fa-pen'></i></a>
                                <a href="{{ path('delete_photo',{'id':photo.id}) }}"> <i
                                            class='fas fa-trash-alt'></i></a>
                            </div>

                            <h5>Photo figure {{ photo.title }}</h5>
                        </div><!-- col-->
                    {% endif %}
                {% endfor %}
            </div>

        {% endif %}

        <!-- Afficher les vidéos si existantes -->
        {% if videos %}
            <div class="alert alert-danger">
                videos là
            </div>

            <!-- Portfolio videos -->
            <div class="row mt-4">
                <div class="col">
                    <h3> Vidéos</h3>
                </div>
            </div>
            {% for video in videos %}
                {% if video.url %}
                    <div class="embed-responsive embed-responsive-16by9 mb-4 mr-4 videoFigure">

                        <iframe class="embed-responsive-item" width="150" height="200"
                                src="{{ video.url }}?controls=0" frameborder="0"
                                allow="accelerometer; autoplay; encrypted-photo; gyroscope; picture-in-picture"
                                allowfullscreen></iframe>
                    </div>

                    <div class="card-header">
                        <a href="{{ path('edit_video',{'slug':video.figure.slug,'id':video.id}) }}"><i
                                    class='fas fa-pen'></i></a>
                        <a href="{{ path('delete_video',{'id':video.id}) }}"> <i
                                    class='fas fa-trash-alt'></i></a>
                    </div>

                    <h5>Video figure {{ video.title }}</h5>
                {% endif %}
            {% endfor %}
        {% endif %}

        {{ form_start(form) }}
        <div class="row">
            <div class="col">
                <div>{{ form_row(form.title,{"label":"Nom de la figure","attr":{ "placeholder":"Nom de la figure"}}) }}</div>

                <div>{{ form_row(form.description,{"label":"Description","attr":{ "placeholder":"Description"}}) }}</div>
                <div>{{ form_row(form.figGroup,{"label":"Groupe de la figure","attr":{ "placeholder":"Groupe de la figure"}}) }}</div>

            </div>
        </div>
        {# {{ form_widget(form) }} #}<!-- si présent active l'affichage des sous-formulaires -->
        <div class="row">

            <button type="submit" class="btn btn-primary mx-2">Soumettre</button>


        </div>
        {#  {{ form_end(form) }} #}
    </div>
{% endblock %}

{# ********************* gestion  du sous-formulaires pour ajout de photos ******************* #}
{% block _create_figure_photos_widget %}
    <p>Modifiez les photos</p>
    {{ form_widget(form) }}
    <div class="form-group">
        <div class="row">
            <button type="button" id="add-photo" class="btn btn-info">Ajouter une photo</button>
        </div>
    </div>
{% endblock %}

{# Gère les champs du sous-formulaire PhotoType #}
{% block _create_figure_photos_entry_row %}
    {{ form_widget(form) }}
{% endblock %}

{% block _create_figure_photos_entry_widget %}
    <div class="form-group" id="photo_{{ id }}"> <!-- id : identifiant du form-group pour le gérer -->
        <div class="row">
            <div class="col">
                {{ form_label(form.title, 'Titre de la photo') }}
                {{ form_widget(form.title) }}
                {{ form_widget(form) }} {# allow to add the photo_load filetype#}
                <button type="button" data-action="delete" data-target="#photo_{{ id }}"
                        class=" mt-3 btn btn-warning">
                    Supprimer le formulaire
                </button>
            </div>
        </div>
    </div>
{% endblock %}

{# ********************* gestion  du sous-formulaire pour ajout de vidéos ******************* #}

{% block _create_figure_videos_widget %}
    <p>Ajoutez des vidéos</p>
    {{ form_widget(form) }}
    <div class="form-group">
        <div class="row">
            <button type="button" id="add-video" class="btn btn-info">Ajouter une vidéo</button>
        </div>
    </div>
{% endblock %}

{# Renomme les champs en mode row du sous-formulaire VideoType par ceux de widget #}
{% block _create_figure_videos_entry_row %}
    {{ form_widget(form) }}
{% endblock %}

{% block _create_figure_videos_entry_widget %}
    <div class="form-group" id="video_{{ id }}">
        <div class="row">
            <div class="col">
                {{ form_label(form.title, 'Titre de la vidéo') }}
                {{ form_widget(form.title) }}
                {{ form_label(form.title, 'Url de la vidéo') }}
                {{ form_widget(form.url) }}
                {{ form_widget(form) }} {# allow to add the video_figure filetype#}
                <button type="button" data-action="delete" data-target="#video_{{ id }}"
                        class=" mt-3 btn btn-warning">
                    Supprimer le formulaire
                </button>
            </div>
        </div>
    </div>


{% endblock %}




{% block javascripts %}
    {#TODO : voir si besoin de factorisez le code en service #}
    <script>
        /*************** créé des instances de formulaire ****************/
        $('#add-photo').click(function () {
            let index = $('#create_figure_photos div.form-group').length; // on récupère les div qui ont la classe form_group
            console.log(index);
            const getPrototypEntry = $('#create_figure_photos').data('prototype').replace(/__name__/g, index);
// add another PhotoType form instance (code)
            $('#create_figure_photos').append(getPrototypEntry);
            deleteMedia();
        });

        $('#add-video').click(function () {
            let index = $('#create_figure_videos div.form-group').length;

            const getPrototypEntry = $('#create_figure_videos').data('prototype').replace(/__name__/g, index);

            $('#create_figure_videos').append(getPrototypEntry);
            deleteMedia();
        });


        function deleteMedia() {

            $('button[data-action = "delete"]').click(function () {
                    const mediatarget = this.dataset.target;

                    $(mediatarget).remove();
                }
            );
        }

        deleteMedia();

    </script>
{% endblock %}